{% extends 'nav.html' %}

{% block title %}Patient Home{% endblock %}

{% block content %}
<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: Arial, sans-serif;
        background-color: #f9f9f9;
    }


    .main-content {
        display: flex;
        justify-content: center;
        align-items: center;
    
        padding: 20px;
        box-sizing: border-box;
    }

    .form-container {
            width: 600px;
            margin: 40px auto;
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

    .form-container h2 {
        text-align: center;
        margin-bottom: 80px;
        color: #333;
        font-size: 1.6rem;
        padding: 3%;
    }

    .form-container label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #555;
        font-size: 1rem;
    }

    .form-container input,
    .form-container select,
    .form-container button {
        width: 100%;
        padding: 12px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 1rem;
    }

    .form-container button {
        background-color: #007bff;
        color: #fff;
        border: none;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .form-container button:hover {
        background-color: #0056b3;
    }

    .form-container img {
        display: block;
        margin: 20px auto;
        border-radius: 50%;
        max-width: 120px;
        height: auto;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .gender-container {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
    }

    .gender-container label {
        font-weight: normal;
        color: #333;
    }

    #formatted_time {
        font-style: italic;
        color: #666;
        font-size: 0.9rem;
        margin-top: -10px;
    }

    /* Responsive design for smaller screens */
    @media (max-width: 768px) {
        .form-container {
            padding: 15px;
        }

        .form-container h2 {
            font-size: 1.5rem;
        }

        .gender-container {
            flex-direction: column;
            align-items: flex-start;
        }

        .form-container input,
        .form-container select,
        .form-container button {
            font-size: 0.9rem;
        }
    }
    .text-success {
        color: green;
        font-weight: bold;
    }
    .text-danger {
        color: red;
        font-weight: bold;
    }
    </style>
<div class="main-content">
<div class="form-container">
    <h2>Book an Appointment</h2>
    <div>
        {% if messages %}
            {% for message in messages %}
                <h2 
                    class="text-center pt-2 
                    {% if message.tags == 'success' %}text-success{% elif message.tags == 'error' %}text-danger{% endif %}">
                    {{ message }}
                </h2>
            {% endfor %}
        {% endif %}
    </div>
    <form method="POST" action="{% url 'create_booking' %}">
        {% csrf_token %}

        <!-- Patient Details -->
        <label for="patient_id">Patient ID</label>
        <input type="text" id="patient_id" name="patient_id" value="{{ patient_details.patient_id  }}" readonly>

        <label for="first_name">First Name</label>
        <input type="text" id="first_name" name="first_name" value="{{ patient_details.user.first_name }}" readonly>

        <label for="last_name">Last Name</label>
        <input type="text" id="last_name" name="last_name" value="{{ patient_details.user.last_name }}" readonly>

        <label for="email">Email</label>
        <input type="email" id="email" name="email" value="{{ patient_details.user.email }}" readonly>

        <label for="gender">Gender</label>
        <div class="gender-container">
            <label>
                <input type="radio" name="gender" value="male" {% if patient_details.Gender == "male" %}checked{% endif %} disabled>
                Male
            </label>
            <label>
                <input type="radio" name="gender" value="female" {% if patient_details.Gender == "female" %}checked{% endif %} disabled>
                Female
            </label>
            <label>
                <input type="radio" name="gender" value="other" {% if patient_details.Gender == "other" %}checked{% endif %} disabled>
                Other
            </label>
        </div>

        <label for="age">Age</label>
        <input type="number" id="age" name="age" value="{{ patient_details.age }}" readonly>

        <label for="address">Address</label>
        <input type="text" id="address" name="address" value="{{ patient_details.address }}" readonly>

        {% if patient_details.image %}
        <img src="{{ patient_details.image.url }}" alt="Patient Image">
        {% else %}
        <p style="text-align: center; color: gray;">No image available</p>
        {% endif %}

        <!-- Department Dropdown -->
        <label for="department">Select Department:</label>
<select id="department" name="department" required>
    <option value="">Select a department</option>
    {% for department in departments %}
        <option value="{{ department.id }}">{{ department.DepatmentName }}</option>
    {% endfor %}
</select>

<label for="doctor">Select Doctor:</label>
<select id="doctor" name="doctor" required>
    <option value="">Select a doctor</option>
</select>

        
        

        
        
        


        <!-- Appointment Date -->
        <label for="appointment_date">Appointment Date</label>
        <input type="date" id="appointment_date" name="appointment_date" min="{{ today_date }}" required>

        <!-- Appointment Time -->
        <label for="appointment_time">Appointment Time</label>
        <input type="time" id="appointment_time" name="appointment_time" required>
        <p id="formatted_time"></p>

        <!-- Submit Button -->
        <button type="submit">Book Appointment</button>
    </form>
</div>
</div>
<script>
    document.getElementById("department").addEventListener("change", function () {
        const departmentId = this.value; // Get the selected department ID

        if (departmentId) {
            fetch(`/get-doctors/${departmentId}/`) // Replace with your Django endpoint
                .then(response => response.json())
                .then(data => {
                    const doctorDropdown = document.getElementById("doctor");
                    doctorDropdown.innerHTML = '<option value="">Select a doctor</option>'; // Clear previous options

                    if (data.doctors && data.doctors.length > 0) {
                        data.doctors.forEach(doctor => {
                            const option = document.createElement("option");
                            option.value = doctor.id;
                            option.textContent = doctor.name;
                            doctorDropdown.appendChild(option);
                        });
                    } else {
                        alert("No doctors found for the selected department.");
                    }
                })
                .catch(error => console.error("Error fetching doctors:", error));
        } else {
            // Reset the doctor dropdown if no department is selected
            document.getElementById("doctor").innerHTML = '<option value="">Select a doctor</option>';
        }
    });
    const timeInput = document.getElementById('appointment_time');
    const formattedTime = document.getElementById('formatted_time');

    // Function to convert 24-hour time to 12-hour format with AM/PM
    function formatTimeTo12Hour(time) {
        const [hours, minutes] = time.split(':');
        const hoursInt = parseInt(hours, 10);
        const ampm = hoursInt >= 12 ? 'PM' : 'AM';
        const hours12 = hoursInt % 12 || 12; // Convert to 12-hour format
        return `${hours12}:${minutes} ${ampm}`;
    }

    // Add an event listener to format and display the time when it changes
    timeInput.addEventListener('input', () => {
        const timeValue = timeInput.value;
        if (timeValue) {
            formattedTime.textContent = `Selected Time: ${formatTimeTo12Hour(timeValue)}`;
        } else {
            formattedTime.textContent = '';
        }
    });   
</script>




{% endblock %}
